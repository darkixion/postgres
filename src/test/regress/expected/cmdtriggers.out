--
-- COMMAND TRIGGERS
--
create or replace function snitch
 (in tg_when text, in cmd_tag text, in objectid oid, in schemaname text, in objectname text)
 returns void language plpgsql
as $$
begin
  -- can't output the objectid here that would break pg_regress
  raise notice 'snitch: % % % %', tg_when, cmd_tag, schemaname, objectname;
end;
$$;
create trigger snitch_before before any command execute procedure snitch();
create trigger snitch_after  after  any command execute procedure snitch();
NOTICE:  snitch: AFTER CREATE COMMAND TRIGGER <NULL> <NULL>
create trigger snitch_some_more
         after command create table, alter table, create function
       execute procedure snitch();
NOTICE:  snitch: AFTER CREATE COMMAND TRIGGER <NULL> <NULL>
NOTICE:  snitch: AFTER CREATE COMMAND TRIGGER <NULL> <NULL>
create schema cmd;
NOTICE:  snitch: AFTER CREATE SCHEMA <NULL> <NULL>
NOTICE:  snitch: AFTER CREATE SCHEMA <NULL> <NULL>
create table cmd.foo(id bigserial primary key);
NOTICE:  CREATE TABLE will create implicit sequence "foo_id_seq" for serial column "foo.id"
NOTICE:  snitch: AFTER CREATE SEQUENCE <NULL> <NULL>
NOTICE:  snitch: AFTER CREATE SEQUENCE <NULL> <NULL>
NOTICE:  CREATE TABLE / PRIMARY KEY will create implicit index "foo_pkey" for table "foo"
NOTICE:  snitch: AFTER CREATE INDEX <NULL> <NULL>
NOTICE:  snitch: AFTER CREATE INDEX <NULL> <NULL>
NOTICE:  snitch: AFTER ALTER SEQUENCE <NULL> <NULL>
NOTICE:  snitch: AFTER ALTER SEQUENCE <NULL> <NULL>
NOTICE:  snitch: AFTER CREATE TABLE cmd foo
NOTICE:  snitch: AFTER CREATE TABLE <NULL> <NULL>
NOTICE:  snitch: AFTER CREATE TABLE <NULL> <NULL>
create view cmd.v as select * from cmd.foo;
NOTICE:  snitch: AFTER CREATE VIEW <NULL> <NULL>
NOTICE:  snitch: AFTER CREATE VIEW <NULL> <NULL>
alter table cmd.foo add column t text;
NOTICE:  snitch: AFTER ALTER TABLE cmd foo
NOTICE:  snitch: AFTER ALTER TABLE <NULL> <NULL>
NOTICE:  snitch: AFTER ALTER TABLE <NULL> <NULL>
create index on cmd.foo(t);
NOTICE:  snitch: AFTER CREATE INDEX <NULL> <NULL>
NOTICE:  snitch: AFTER CREATE INDEX <NULL> <NULL>
create function cmd.fun(int) returns text language sql
as $$ select t from cmd.foo where id = $1; $$;
NOTICE:  snitch: AFTER CREATE FUNCTION cmd fun
NOTICE:  snitch: AFTER CREATE FUNCTION <NULL> <NULL>
NOTICE:  snitch: AFTER CREATE FUNCTION <NULL> <NULL>
drop schema cmd cascade;
NOTICE:  drop cascades to 3 other objects
DETAIL:  drop cascades to table cmd.foo
drop cascades to view cmd.v
drop cascades to function cmd.fun(integer)
NOTICE:  snitch: AFTER DROP SCHEMA <NULL> <NULL>
NOTICE:  snitch: AFTER DROP SCHEMA <NULL> <NULL>
drop trigger snitch_before on any command;
NOTICE:  snitch: AFTER DROP COMMAND TRIGGER <NULL> <NULL>
drop trigger snitch_after  on any command;
drop trigger snitch_some_more on command create table, alter table, create function;
